{% extends "base.html" %}
{% load static %}

{% block headextra %}
<link rel="stylesheet" href="{% static 'style/ra.css' %}" />
{% endblock %}


{% block title %}View Visit for {{ visit.get_full_name }} at {{ visit.get_created_at_display }}{% endblock %}
{% block h1 %}View Visit for {{ visit.get_full_name }} at {{ visit.get_created_at_display }}{% endblock %}

{% block subbreadcrumbs %}
<li><a href="{% url "advising:advising" %}">Advising</a></li>
<li><a href="{% url "advising:student_notes" userid=userid %}">{{ visit.get_full_name }}</a></li>
<li>View Visit</li>
{% endblock %}

{% block content %}
    <table class="info">
<tr><th>Student</th><td>{{ visit.get_full_name }}</td></tr>
<tr><th>Advisor</th><td>{{ visit.advisor.sortname_pref_only }}</td></tr>
<tr><th>Unit</th><td>{{ visit.unit }}</td></tr>
<tr><th>Start Time</th><td>{{ visit.created_at }}</td></tr>
{% if visit.end_time %}<tr><th>End Time</th><td>{{ visit.end_time }}</td></tr>{% endif %}
{% if visit.end_time %}<tr><th>Duration</th><td>{{ visit.get_duration }}</td></tr>{% endif %}
{% if visit.mode %}<tr><th>Mode</th><td>{{ visit.get_mode_display }}</td></tr>{% endif %}
{% if visit.campus %}<tr><th>Campus</th><td>{{ visit.get_campus_display }}</td></tr>{% endif %}
{% if visit.has_categories %}<tr><th>Categories</th><td>{{ visit.categories_display }}</td></tr>{% endif %}
    </table>

{% if visit.has_sims_data %}
<h2>Data gathered from SIMS at time of visit</h2>
    <table class="info">
{% if visit.programs %}<tr><th>Programs</th><td>{{ visit.programs|linebreaks }}</td></tr>{% endif %}
{% if visit.cgpa %}<tr><th>CGPA</th><td>{{ visit.cgpa }}</td></tr>{% endif %}
{% if visit.credits %}<tr><th>Credits</th><td>{{ visit.credits }}</td></tr>{% endif %}
{% if visit.gender %}<tr><th>Gender</th><td>{{ visit.get_gender_display }}</td></tr>{% endif %}
{% if visit.citizenship %}<tr><th>Citizenship</th><td>{{ visit.citizenship }}</td></tr>{% endif %}
    </table>
{% endif %}

{% if is_manager %}
    <div class="form_section">
    {% if survey and visit.survey_sent %}
        {% if survey.is_completed %}
        <p><i>Survey completed on {{ survey.completed_at }}</i><br></p>
        <p><b>Was 15 minutes enough time for your appointment?</b></p><p>{{ survey.get_time_display }}</p>
        <p><b>How would you rate your appointment overall?</b></p><p>{{ survey.get_overall_display }}</p>
        <p><b>What was the main reason for your advising appointment?</b></p><p>{{ survey.reason_display }}</p>
        <p><b>Did the advisor answer your question(s)?</b></p><p>{{ survey.get_questions_answered_display }}</p>
        <p><b>I feel supported during my advising appointment?</b></p><p>{{ survey.get_support_display }} </p>
        <p><b>The advisorâ€¦ (select all that apply)</b>
            <ul>
            {% for answer in survey.advisor_review_display %}
            {{ answer }}</p>
            {% endfor %}
            </ul>
        <p><b>If your question wasn't fully answered during your appointment, what was the main reason? (Select the option that best describes your experience)</b></p><p>{{ survey.questions_unanswered_display }}</p>
        <p><b>Any other comments? (Optional)</p></b></p><p>{{ survey.comments }}</p>


        {% else %}
        Survey has been sent, but not yet completed. Expiry date: {{ survey_expiry }}
        {% endif %}
    {% elif not survey and visit.survey_sent %}
        Survey was sent, but never completed.
    {% endif %}
    </div>
{% endif %}
{% endblock %}