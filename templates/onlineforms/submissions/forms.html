{% extends "base-wide.html" %}
{% load form_display %}
{% load static %}
{% block h1 %} Forms {% endblock %}
{% block title %} Forms {% endblock %}

{% block subbreadcrumbs %}
<li>Forms</li>
{% endblock %}

{% block headextra %}
<script nonce="{{ CSP_NONCE }}">
    $(document).ready(function() {
        $("h3.summary_heading").collapsible();
        $("h2.summary_heading").collapsible();

        // http://live.datatables.net/sovoyuyu/1/edit
        $('#sheet_table').dataTable({
                        "bPaginate": false,
                        "bJQueryUI": true,
                        "aaSorting": [[2, "asc"]],
        });
        var tables = $('table.display:not(#sheet_table)').DataTable({
                    "bPaginate": false,
                    "bJQueryUI": true,
                    "aaSorting": [[0, "asc"]],
                    // https://datatables.net/reference/option/dom
        }); 
        $('#formSearch').on('keyup click', function () {
         tables.tables().search($(this).val()).draw();
        });
    });
</script>
{% endblock %}

{% block content %}

<p><b>
{% if form_groups or form_admin %}
    {% if form_groups %}
        <a href="{% url "onlineforms:list_all" %}">Create/Edit Forms</a></li>
        | <a href="{% url "onlineforms:admin_list_all" %}">Manage Submissions</a></li>
    {% endif %}
    {% if form_admin %}
        | <a href="{% url "onlineforms:manage_groups" %}">Manage Form Groups</a></li>
    {% endif %}
    {% if participated %}
        | <a href="{% url "onlineforms:participated_in" %}">
            View forms in which you participated
        </a>
        {% endif %}
    {% elif participated %}
        | <a href="{% url "onlineforms:participated_in" %}">View completed forms in which you participated</a></li>
    {% endif %}
</b></p>




{% if sheet_submissions %}
<h2 id="assigned">Assigned Forms</h2>
<div class="datatable_container">
    <table class="display" id="sheet_table">
        <thead>
            <tr>
                <th scope="col">Your Sheet</th>
                <th scope="col">Form</th>
                <th scope="col">Waiting Since</th>
            </tr>
        </thead>
        {% for sheet_sub in sheet_submissions %}
            <tr>
                <td><a href="{% url "onlineforms:sheet_submission_subsequent" form_slug=sheet_sub.form_submission.form.slug formsubmit_slug=sheet_sub.form_submission.slug sheet_slug=sheet_sub.sheet.slug sheetsubmit_slug=sheet_sub.slug %}">{{ sheet_sub.sheet.title }}</a></td>
                <td>{{ sheet_sub.form_submission.form.title }} (from {{ sheet_sub.form_submission.initiator.name }})</td>
                <td><span class="sort">{{ sheet_sub.given_at.isoformat }}</span>{{ sheet_sub.given_at }}</td>
            </tr>
        {% endfor %}
    </table>
</div>
{% endif %}

<h2 id="new">Available Forms</h2>
 	<p>These forms can be filled out and submitted online.</p>
    {% if recent_forms %}
        <h3 class="summary_heading collapsible-heading-collapsed"><a href="#!general"></a>Recently Completed Forms</h3>
        <div id="summary_content" class="collapse_menu">
            <span class="helptext">Forms initiated in the last 60 days:<br/></span>
                <ul> {% for initial_sheet in recent_forms %}<li> <a href="{% url "onlineforms:sheet_submission_initial" form_slug=initial_sheet.form_submission__form__slug %}">{{ initial_sheet.form_submission__form__title }}</a> ({{ initial_sheet.form_submission__form__unit__name }}) </li> {% endfor %}</ul>
        </div>
    {% endif %}
    {% regroup forms by unit as unit_list %}

    {% for data in unit_list %}
    <div class="datatable_container">
        <h2 class="summary_heading collapsible-heading-toggle" id="forms-{{data.grouper.slug}}">{{ data.grouper.name }}</h3>
        <table class="display">
            <thead>
                <tr>
                    <th scope="col">Name</th>
                    <th scope="col">Details</th>
                </tr>
            </thead>
                {% for f in data.list %}
                <tr>
                    <td width="20%"><a href="{% url "onlineforms:sheet_submission_initial" form_slug=f.slug %}">{{ f.title }}</a> </td>
                    <td>{{ f.description }}</td>
                </tr>
                {% endfor %}
        </table>
    </div>
    {% endfor %}
    {% if other_forms %}
    <h2 id="other">Forms for Logged-In Users</h2>

    <table class="display">
        <thead>
            <tr>
                <th scope="col">Name</th>
                <th scope="col">Details</th>
            </tr>
        </thead>
        {% for form in other_forms %}
            <tr>
                <td width="20%"><a href="{% url "onlineforms:sheet_submission_initial" form_slug=form.slug %}">{{ form.title }}</a> ({{ form.unit.name }}) </td>
                <td>{{ form.description }}</td>
            </tr>
        {% endfor %}
    </table>
    {% endif %}

{% endblock %}

